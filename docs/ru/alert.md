# Core module `alert`

Модуль `alert` предназначен для изменения статута Алерта и отправки сообщения об этом, если необходимо

## Пример использования

```
local alert = require('alert')

alert.error('alert-name-1', 'Alert Text')
alert.error('alert-name-2', 'Alert Text', { quiet = true }) 
```

Алерт может иметь три уровня (или состояния)
- error
- warn
- success

При изменнии текущего уровня алерта будет отправлено сообщение.

В конфигурации системы и/или в мета данных скрипта можно указать, в какие каналы отправлять сообщения с тем или иным уровнем.

Например, вы можете настроить отправку сообщений дежурному инженеру при включении всех уровней. А руководителю только при включении увроня `error`.
Такми образом, инженер может получать уведомление об уровне `warn` и предпринять некотрые действия. Если ситуация продолжает развиваться и уровень повышается до `error` - автоматически будет произведена отправка сообщения в каналы, которые доступны руководству. 

Отправку сообщения можно отменить установив опцию алерта `quiet` в `true` 

По умолчанию, если алерт получил какой-то уровень и сообщение об этом было отправлено, последующие сообщения об этом уходить не будут.
Это поведение можно настроить в опциях.

```
alert.error('alert-1', 'an error occured', { repeat = <NUM_SKIP_MESSAGES> })
```

Если параметр `repeat` уставновлен в -1 (по умолчанию), то сообщение об этом алерте будет отправлено только в момент изменения уровня с `success` или `warn` на `error`

Далее, допустим, скрипт выполняется каждую минуту и вызывает этот метод. Но поскольку алерт с именем `alert-1` уже имеет уровень `error`, сообщение отправлять не будет.

Можно переопределить это, указав количество сообщений, через которое необходимо повторить отправку.

Например:

```
-- Сообщение с этим алертом будет отправлено кадый раз, когда оно вызывается в скрипте
alert.error('alert-1', 'an error occured', { repeat = 0 })

-- Сообщение с этим алертом будет отправлено через каждые 5 вызовов
-- к примеру, если скрипт выполняется каждую минуту, то получается, каждые 5 минут вы будете получать сообщения об этом алерте 
alert.error('alert-1', 'an error occured', { repeat = 5 })
```

### Методы модуля

При вызове функций модуля `alert` первым параметров всегда необходимо указать имя алерта. Это должна быть уникальная строка, по которому система идентифицирует алерт.

Остальные параметры не обязательны. 
- текст сообщения
- опции


#### error

> `alert.error(<ALERT_NAME>[, <ALERT_TEXT>[, <ALERT_OPTIONS>]])` 

Установка уровня алерта в значение `error`

Метод имеет два алиаса

- on
- fail

Пример использования:

```
alert.error('alert-1', 'Alert Text')
alert.on('alert-2')
alert.fail('alert-3', 'Alert Text', { quiet = true })
```

#### warn

> `alert.warn(<ALERT_NAME>[, <ALERT_TEXT>[, <ALERT_OPTIONS>]])` 

Установка уровня алерта в значение `warn`

Пример использования:

```
alert.warn('alert-1', 'Alert Text')
```

#### success

> `alert.success(<ALERT_NAME>[, <ALERT_TEXT>[, <ALERT_OPTIONS>]])` 

Установка уровня алерта в значение `warn`

Метод имет два алиаса:

- off
- ok

Пример использования:

```
alert.success('alert-1', 'Alert Text')
alert.off('alert-2')
alert.ok('alert-3', 'Alert Text', { quiet = true })
```

#### info

> `alert.info(<ALERT_NAME>[, <ALERT_TEXT>[, <ALERT_OPTIONS>]])` 

Данный метод используется просто для отправки сообщения. 

Алерт не меняет свой текущий уровень.